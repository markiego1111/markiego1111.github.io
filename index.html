<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ===== META & STYLE DEFINITIONS ===== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event UK: Source Entertainment Simulator</title>
  <style>
    /* ===== BASIC PAGE STYLES ===== */
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #fff;
    }
    h1 { font-size: 2rem; }
    h2 { margin-top: 2rem; font-size: 1.3rem; }
    .section { margin-bottom: 1.5rem; }

    /* ===== PILL SELECTOR STYLING ===== */
    .pill {
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 30px;
      padding: 12px 20px;
      margin: 5px;
      cursor: pointer;
      font-size: 1.1rem;
      background-color: white;
    }
    .pill.selected {
      background-color: #0B978A;
      color: white;
      border-color: #0B978A;
    }

    /* ===== TEXTAREA & BUTTON STYLES ===== */
    .textarea {
      width: 100%;
      height: 120px;
      padding: 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .button {
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 30px;
      border: none;
      cursor: pointer;
      margin: 0.5rem 0.5rem 1rem 0;
    }
    .spinner {
  display: inline-block;
  width: 1rem;
  height: 1rem;
  border: 2px solid #fff;
  border-top: 2px solid transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  vertical-align: middle;
  margin-right: 4px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
    .primary {
      background-color: #0B978A;
      color: white;
    }
    .secondary {
      background-color: white;
      color: black;
      border: 1px solid grey;
    }
    .disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .textarea-label {
      display: block;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .text-muted {
      color: #555;
      font-weight: bold;
    }
    .ai-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <!-- ===== PAGE HEADER ===== -->
  <h1>Event UK: Source Entertainment Simulator</h1>

  <!-- ===== ENTERTAINMENT TYPE SECTION ===== -->
  <div class="section">
    <h2>Entertainment Type</h2>
    <div id="entertainment"></div>
  </div>

  <!-- ===== DATE & TIME PICKER SECTION ===== -->
  <div class="section">
    <h2>Select Date & Time</h2>
    <input type="date" id="date" class="pill" />
    <input type="time" id="time" class="pill" />
  </div>

  <!-- ===== MUSIC STYLE SELECTION ===== -->
  <div class="section">
    <h2>Music Style (up to 5)</h2>
    <div id="music"></div>
  </div>

  <!-- ===== DJ STYLE SELECTION ===== -->
  <div class="section">
    <h2>DJ Style (up to 5)</h2>
    <div id="dj"></div>
  </div>

  <!-- ===== EQUIPMENT SELECTION ===== -->
  <div class="section">
    <h2>Equipment</h2>
    <div id="equipment"></div>
  </div>

  <!-- ===== USER DESCRIPTION + AI BUTTONS ===== -->
<div class="section">
  <h2>Describe your event</h2>
  <span class="text-muted">Things to include:</span> What's the occasion?, Who's the crowd?, What's the vibe?, Any music genres you don't want played?
  <div class="ai-buttons">
    <button class="button primary" onclick="generateAI()" id="aiButton">
  <span id="aiIcon">âœ¨</span> Help with AI
</button>
    <button class="button secondary" id="restoreBtn" onclick="restoreOriginal()" style="display:none">Restore Original</button>
  </div>
  <div style="padding-right: 2rem;">
    <textarea id="description" class="textarea" placeholder="Describe your event..."></textarea>
  </div>
</div>

  <!-- ===== NEXT BUTTON ===== -->
  <button id="nextBtn" class="button primary disabled" disabled>Summarise</button>
  <div id="summaryOutput" style="margin-top: 1rem; font-size: 1rem;"></div>

  <!-- ===== SCRIPT SECTION START ===== -->
  <script>
    // ===== CONSTANTS & STATE =====
    const entertainmentTypes = ["DJ", "Live Music", "Karaoke", "Quiz", "Tribute", "Drag", "Bingo", "Childrens Entertainer", "Bandeoke", "Magician", "Open Mic Host", "Poker", "Comedy", "Santa"];
    const musicStyles = ["70s", "80s", "90s", "00s", "Current Hits", "Britpop", "Dance", "Disco", "Electronic", "Funk", "Hip Hop", "House", "Indie", "Motown", "Pop", "R&B", "Rock", "Soul"];
    const djStyles = ["Personality DJ", "No Mic Work", "Some Mic Work", "No Requests", "Take Requests", "Beat Mixing", "Keep 'em Singing", "Keep 'em Dancing", "Older Audience", "Younger Audience"];
    const equipmentOptions = ["Laptop, Decks & Mixer", "PA System", "Lights", "Full Mobile Rig","None"];

    let selectedEntertainment = null;
    let selectedMusic = [];
    let selectedDJ = [];
    let selectedEquipment = [];
    let originalDescription = "";

    const maxMusic = 5;
    const maxDJ = 5;

    // ===== RENDER PILLS TO DOM =====
    function renderPills(id, list, selected, callback) {
      const container = document.getElementById(id);
      container.innerHTML = "";
      list.forEach(item => {
        const pill = document.createElement("div");
        pill.className = "pill" + (selected.includes(item) ? " selected" : "");
        pill.textContent = item;
        pill.onclick = () => callback(item);
        container.appendChild(pill);
      });
    }

    // ===== TOGGLE ENTERTAINMENT TYPE (SINGLE SELECT) =====
    function toggleEntertainment(item) {
      selectedEntertainment = selectedEntertainment === item ? null : item;
      renderAll();
      validateNext();
    }

    // ===== GENERIC TOGGLE CALLBACK GENERATOR (LIMITED MULTI-SELECT) =====
    function makeToggleCallback(getter, setter, max) {
      return function(item) {
        let selectedList = getter();
        const index = selectedList.indexOf(item);
        if (index >= 0) {
          selectedList.splice(index, 1);
        } else if (selectedList.length < max) {
          selectedList.push(item);
        }
        setter([...selectedList]);
        renderAll();
        validateNext();
      };
    }

    // ===== TOGGLE EQUIPMENT OPTIONS =====
    function toggleEquipment(item) {
      if (item === "None") {
        selectedEquipment = ["None"];
      } else {
        selectedEquipment = selectedEquipment.filter(i => i !== "None");
        if (selectedEquipment.includes(item)) {
          selectedEquipment = selectedEquipment.filter(i => i !== item);
        } else {
          selectedEquipment.push(item);
        }
      }
      renderAll();
      validateNext();
    }

    // ===== GETTERS & SETTERS FOR MUSIC / DJ =====
    function setSelectedMusic(list) { selectedMusic = list; }
    function getSelectedMusic() { return selectedMusic; }
    function setSelectedDJ(list) { selectedDJ = list; }
    function getSelectedDJ() { return selectedDJ; }

    // ===== VALIDATE NEXT BUTTON STATE =====
    function validateNext() {
      const next = document.getElementById("nextBtn");
      if (selectedEntertainment && selectedMusic.length > 0 && selectedDJ.length > 0 && selectedEquipment.length > 0) {
        next.classList.remove("disabled");
        next.disabled = false;
      } else {
        next.classList.add("disabled");
        next.disabled = true;
      }
    }
// ===== GENERATE SUMMARY OUTPUT =====
function generateSummary() {
  const summaryBox = document.getElementById("summaryOutput");
  const date = document.getElementById("date").value;
  const time = document.getElementById("time").value;
  const entertainment = selectedEntertainment || "N/A";
  const music = selectedMusic.join(", ") || "N/A";
  const dj = selectedDJ.join(", ") || "N/A";
  const description = document.getElementById("description").value.trim() || "N/A";

// ===== SANITIZE DESCRIPTION TO EXTRACT CLEAN LISTING & BODY =====
const listingLine = description.replace(/\*\*Title:\*\*\s*/i, "").split("\n")[0];
const bodyText = description
  .replace(/\*\*Title:\*\*.*?\n?/i, "")   // remove title line entirely
  .replace(/\*\*Description:\*\*\s*/i, "") // remove description heading
  .trim();
  
  const formattedDate = date
    ? new Date(date).toLocaleDateString("en-GB", { weekday: 'short', day: 'numeric', month: 'short' })
    : "N/A";

  summaryBox.innerHTML = `
    <div><strong>Listing:</strong> ${listingLine}</div>
    <div><strong>Date:</strong> ${formattedDate}</div>
    <div><strong>Time:</strong> ${time || "N/A"}</div>
    <div><strong>Act Type:</strong> ${entertainment}</div>
    <div><strong>Music Style:</strong> ${music}</div>
    <div><strong>DJ Style:</strong> ${dj}</div>
    <div><strong>Description:</strong> ${bodyText}</div>
  `;
}
    // ===== AI GENERATE DESCRIPTION BUTTON =====
    function generateAI() {
      originalDescription = document.getElementById("description").value;
      callGeminiAI();
    }

    // ===== RESTORE USER'S ORIGINAL DESCRIPTION =====
    function restoreOriginal() {
      document.getElementById("description").value = originalDescription;
      document.getElementById("restoreBtn").style.display = "none";
    }

    // ===== MAIN RENDER FUNCTION =====
    function renderAll() {
      renderPills("entertainment", entertainmentTypes, selectedEntertainment ? [selectedEntertainment] : [], toggleEntertainment);
      renderPills("music", musicStyles, selectedMusic, makeToggleCallback(getSelectedMusic, setSelectedMusic, maxMusic));
      renderPills("dj", djStyles, selectedDJ, makeToggleCallback(getSelectedDJ, setSelectedDJ, maxDJ));
      renderPills("equipment", equipmentOptions, selectedEquipment, toggleEquipment);
    }
    // ===== SETUP SUMMARY BUTTON CLICK HANDLER =====
    document.getElementById("nextBtn").addEventListener("click", generateSummary);
    
    // ===== INITIAL RENDER ON LOAD =====
    renderAll();

    // ===== GEMINI API CALL FUNCTION =====
    function callGeminiAI() {
      const descriptionBox = document.getElementById("description");
      const restoreBtn = document.getElementById("restoreBtn");
      const entertainment = selectedEntertainment;
      const music = selectedMusic.join(", ");
      const dj = selectedDJ.join(", ");
      const userText = descriptionBox.value;
      const aiIcon = document.getElementById("aiIcon");
aiIcon.innerHTML = `<span class="spinner"></span>`;

      const prompt = `
You are generating event listings for a professional entertainment booking app.
Based on the input provided, generate:
1. A title (max 110 characters) â€“ clear, professional, and punchy
2. A description â€“ factual, concise, and informative

Do NOT assumptions about the venue, crowd, or vibe unless explicitly stated. Do not repeat the event date, time, price, or location unless included in user-provided description. Only use fields that are present; never show placeholders or undefined values. Default to clarity over flair, be specific, not vague. Mention music genres or styles where relevant. Keep tone professional but engaging.

Lean towards what kind of act the venue is seeking in terms of style, flexibility, energy, or practical requirements. Highlight performance needs if implied. Avoid vague generalities.

Use all available inputs:
â€¢ entertainment type
â€¢ music style
â€¢ DJ style
â€¢ user-provided description (if any)

If no user description is given, generate using only the structured fields.

Entertainment Type: ${entertainment}
Music Style: ${music}
DJ Style: ${dj}
User Description: ${userText || "*None*"}
`;

      fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyCjhJ5X8zIbe4Q95jVTtfRLbHFiHfjEJ_E", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }]
        })
      })
        .then(res => res.json())
        .then(data => {
          const text = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
          if (text && text.length > 0) {
            descriptionBox.value = text;
          } else {
            descriptionBox.value = "Apologies, can't connect right now. Please try later.";
          }
          restoreBtn.style.display = "inline-block";
          aiIcon.innerHTML = "âœ¨"; // <--- Add this
        })
        .catch(error => {
          console.error("Gemini API error:", error);
          descriptionBox.value = "Apologies, can't connect right now. Please try later.";
          aiIcon.innerHTML = "âœ¨"; // <--- Add this
        });
    }
  </script>
</body>
</html>
