<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event UK: Source Entertainment Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #fff;
    }
    h1 {
      font-size: 2rem;
    }
    h2 {
      margin-top: 2rem;
      font-size: 1.3rem;
    }
    .section {
      margin-bottom: 1.5rem;
    }
    .pill {
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 30px;
      padding: 12px 20px;
      margin: 5px;
      cursor: pointer;
      font-size: 1.1rem;
      background-color: white;
    }
    .pill.selected {
      background-color: #0B978A;
      color: white;
      border-color: #0B978A;
    }
    .textarea {
      width: 100%;
      height: 120px;
      padding: 1rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .button {
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 30px;
      border: none;
      cursor: pointer;
      margin: 0.5rem 0.5rem 1rem 0;
    }
    .primary {
      background-color: #0B978A;
      color: white;
    }
    .secondary {
      background-color: white;
      color: black;
      border: 1px solid grey;
    }
    .disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .textarea-label {
      display: block;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .text-muted {
      color: #555;
      font-weight: bold;
    }
    .ai-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Event UK: Source Entertainment Simulator</h1>

  <div class="section">
    <h2>Entertainment Type</h2>
    <div id="entertainment"></div>
  </div>

  <div class="section">
    <h2>Select Date & Time</h2>
    <input type="date" id="date" class="pill" />
    <input type="time" id="time" class="pill" />
  </div>

  <div class="section">
    <h2>Music Style (up to 5)</h2>
    <div id="music"></div>
  </div>

  <div class="section">
    <h2>DJ Style (up to 5)</h2>
    <div id="dj"></div>
  </div>

  <div class="section">
    <h2>Equipment</h2>
    <div id="equipment"></div>
  </div>

  <div class="section">
    <h2>Describe your event</h2>
    <span class="text-muted">Things to include:</span> What's the occasion?, Who's the crowd?, What's the vibe?, Any music genres you don't want played?
    <div class="ai-buttons">
      <button class="button primary" onclick="generateAI()">✨ Help with AI</button>
      <button class="button secondary" id="restoreBtn" onclick="restoreOriginal()" style="display:none">Restore Original</button>
    </div>
    <textarea id="description" class="textarea" placeholder="Describe your event..."></textarea>
  </div>

  <button id="nextBtn" class="button primary disabled" disabled>Next</button>

  <script>
    const entertainmentTypes = ["DJ", "Live Music", "Karaoke", "Quiz", "Tribute", "Drag", "Bingo", "Childrens Entertainer", "Bandeoke", "Magician", "Open Mic Host", "Poker", "Comedy", "Santa"];
    const musicStyles = ["70s", "80s", "90s", "00s", "Current Hits", "Britpop", "Dance", "Disco", "Electronic", "Funk", "Hip Hop", "House", "Indie", "Motown", "Pop", "R&B", "Rock", "Soul"];
    const djStyles = ["Personality DJ", "No Mic Work", "Some Mic Work", "No Requests", "Take Requests", "Beat Mixing", "Keep 'em Singing", "Keep 'em Dancing", "Older Audience", "Younger Audience"];
    const equipmentOptions = ["Laptop, Decks & Mixer", "PA System", "Lights", "Full Mobile Rig","None"];

    let selectedEntertainment = null;
    let selectedMusic = [];
    let selectedDJ = [];
    let selectedEquipment = [];
    let originalDescription = "";

    const maxMusic = 5;
    const maxDJ = 5;

    function renderPills(id, list, selected, callback) {
      const container = document.getElementById(id);
      container.innerHTML = "";
      list.forEach(item => {
        const pill = document.createElement("div");
        pill.className = "pill" + (selected.includes(item) ? " selected" : "");
        pill.textContent = item;
        pill.onclick = () => callback(item);
        container.appendChild(pill);
      });
    }

    function toggleEntertainment(item) {
      selectedEntertainment = selectedEntertainment === item ? null : item;
      renderAll();
      validateNext();
    }

    function makeToggleCallback(getter, setter, max) {
      return function(item) {
        let selectedList = getter();
        const index = selectedList.indexOf(item);
        if (index >= 0) {
          selectedList.splice(index, 1);
        } else if (selectedList.length < max) {
          selectedList.push(item);
        }
        setter([...selectedList]);
        renderAll();
        validateNext();
      };
    }

    function toggleEquipment(item) {
      if (item === "None") {
        selectedEquipment = ["None"];
      } else {
        selectedEquipment = selectedEquipment.filter(i => i !== "None");
        if (selectedEquipment.includes(item)) {
          selectedEquipment = selectedEquipment.filter(i => i !== item);
        } else {
          selectedEquipment.push(item);
        }
      }
      renderAll();
      validateNext();
    }

    function setSelectedMusic(list) { selectedMusic = list; }
    function getSelectedMusic() { return selectedMusic; }
    function setSelectedDJ(list) { selectedDJ = list; }
    function getSelectedDJ() { return selectedDJ; }

    function validateNext() {
      const next = document.getElementById("nextBtn");
      if (selectedEntertainment && selectedMusic.length > 0 && selectedDJ.length > 0 && selectedEquipment.length > 0) {
        next.classList.remove("disabled");
        next.disabled = false;
      } else {
        next.classList.add("disabled");
        next.disabled = true;
      }
    }

    function generateAI() {
  originalDescription = document.getElementById("description").value;
  callGeminiAI();
}

    function restoreOriginal() {
      document.getElementById("description").value = originalDescription;
      document.getElementById("restoreBtn").style.display = "none";
    }

    function renderAll() {
      renderPills("entertainment", entertainmentTypes, selectedEntertainment ? [selectedEntertainment] : [], toggleEntertainment);
      renderPills("music", musicStyles, selectedMusic, makeToggleCallback(getSelectedMusic, setSelectedMusic, maxMusic));
      renderPills("dj", djStyles, selectedDJ, makeToggleCallback(getSelectedDJ, setSelectedDJ, maxDJ));
      renderPills("equipment", equipmentOptions, selectedEquipment, toggleEquipment);
    }

    renderAll();

function callGeminiAI() {
  const descriptionBox = document.getElementById("description");
  const restoreBtn = document.getElementById("restoreBtn");
  const entertainment = selectedEntertainment;
  const music = selectedMusic.join(", ");
  const dj = selectedDJ.join(", ");
  const userText = descriptionBox.value;

  const prompt = `
You are generating event listings for a professional entertainment booking app.
Based on the input provided, generate:
1. A title (max 110 characters) – clear, professional, and punchy
2. A description – factual, concise, and informative

Lean slightly toward what the venue is likely seeking in the act: style, flexibility, energy, or practical requirements. Highlight performance needs if implied. Avoid vague generalities.

DO NOT make assumptions about the venue, crowd, or vibe unless explicitly stated. Do not repeat the event date, time, price, or location unless included in user-provided description. Only use fields that are present; never show placeholders or undefined values. Default to clarity over flair, be specific, not vague. Mention music genres or styles where relevant. Keep tone professional but engaging.

Use all available inputs:
• entertainment type
• music style
• DJ style
• user-provided description (if any)

If no user description is given, generate using only the structured fields.

Entertainment Type: ${entertainment}
Music Style: ${music}
DJ Style: ${dj}
User Description: ${userText || "*None*"}
`;

  fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyCjhJ5X8zIbe4Q95jVTtfRLbHFiHfjEJ_E", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      contents: [{ parts: [{ text: prompt }] }]
    })
  })
    .then(res => res.json())
    .then(data => {
      const text = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
      if (text && text.length > 0) {
        descriptionBox.value = text;
      } else {
        descriptionBox.value = "Apologies, can't connect right now. Please try later.";
      }
      restoreBtn.style.display = "inline-block";
    })
    .catch(error => {
      console.error("Gemini API error:", error);
      descriptionBox.value = "Apologies, can't connect right now. Please try later.";
    });
}
  </script>
</body>
</html>
